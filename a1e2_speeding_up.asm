.INCLUDE "m328Pdef.inc"

.EQU LED0 = PB0
.EQU LED1 = PB1
.EQU LED2 = PB2
.EQU LED3 = PB3
.EQU LED4 = PB4

START:
	SBI DDRB, LED0
	SBI	DDRB, LED1
	SBI DDRB, LED2
	SBI DDRB, LED3
	SBI DDRB, LED4
	SBI PORTB, LED4

	LDI ZL, LOW(INTERVAL << 1)
	LDI ZH, HIGH(INTERVAL << 1)

MAIN:
	LPM R19, Z+
	CYCLE:
		CALL DELAY
		RJMP TURN_ON_NEXT_LED	
		RJMP CYCLE

	RJMP MAIN

TURN_ON_NEXT_LED:
	SBIC PORTB, LED0
	RJMP RESTART_LEDS
	
	IN 	R16, PORTB
	MOV R17, R16
	ANDI R17, 0x1F
	LSR R17
	MOV R18, R16
	ANDI R18, 0xE0
	OR 	R17, R18
	OUT PORTB, R17
	RJMP CYCLE

RESTART_LEDS:
	CBI PORTB, LED0
	SBI PORTB, LED4
	RJMP MAIN

DELAY:
	MOV R2, R19
	DELAY_LOOP:
		DEC R0
		BRNE DELAY_LOOP
		DEC R1
		BRNE DELAY_LOOP
		DEC R2
		BRNE DELAY_LOOP
	RET

INTERVAL: .db 42, 38, 34, 30, 26, 22, 18, 17, 16, 15, 14, 12, 10, 8, 7, 6, 5, 4, 3, 2