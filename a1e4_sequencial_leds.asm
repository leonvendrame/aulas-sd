.INCLUDE "m328Pdef.inc"

.EQU LED0 = PB0
.EQU LED1 = PB1
.EQU LED2 = PB2
.EQU LED3 = PB3
.EQU BTN0 = PB4

START:
	SBI DDRB, LED0
	SBI	DDRB, LED1
	SBI DDRB, LED2
	SBI DDRB, LED3
	CBI DDRB, BTN0
	SBI PORTB, BTN0
	SBI PORTB, LED3

MAIN:
	SBIC PINB, BTN0
	RJMP MAIN
	RJMP TURN_ON_NEXT_LED

	WAITING_BTN0:
		SBIS PINB, BTN0
		RJMP WAITING_BTN0
	
	CALL DELAY
	RJMP MAIN

TURN_ON_NEXT_LED:
	SBIC PORTB, LED0
	RJMP RESTART_LEDS

	IN 	R16, PORTB
	MOV R17, R16
	ANDI R17, 0x0F
	LSR R17
	MOV R18, R16
	ANDI R18, 0xF0
	OR 	R17, R18
	OUT PORTB, R17
	RJMP WAITING_BTN0

RESTART_LEDS:
	CBI PORTB, LED0
	SBI PORTB, LED3
	RJMP WAITING_BTN0

DELAY:
	DEC R0
 	BRNE DELAY
 	DEC R1
 	BRNE DELAY
	RET
